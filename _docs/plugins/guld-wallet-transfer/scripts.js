(function() {
    var textFile = null,
        makeTextFile = function(text) {
            var data = new Blob([text], {
                type: 'text/plain'
            });

            // If we are replacing a previously generated file we need to
            // manually revoke the object URL to avoid memory leaks.
            if (textFile !== null) {
                window.URL.revokeObjectURL(textFile);
            }

            textFile = window.URL.createObjectURL(data);

            return textFile;
        };

    function generateDoc() {
        var date = new Date(Date.now());
        var sender = document.getElementById('sender').value;
        var receiver = document.getElementById('receiver').value;
        var amount = document.getElementById('amount').value;

        var doc = "; requires signature of the debtor\n"
        doc += date.getFullYear() + "/" + date.getDate() + "/" + date.getDay() + " * transfer\n"
        doc += "    " + sender + ":Assets -" + amount + " guld\n"
        doc += "    " + sender + ":Expenses " + amount + " guld\n"
        doc += "    " + receiver + ":Assets " + amount + " guld\n"
        doc += "    " + receiver + ":Income -" + amount + " guld\n"

        return doc;
    }

    var generate = document.getElementById('generate');

    generate.addEventListener('click', function() {
        var email = 'sample@gmail.com';
        var subject = "Autogenerated transaction";
        var emailBody = generateDoc();
        document.location = "mailto:" + email + "?subject=" + subject + "&body=" + emailBody;
        /*
        var link = document.getElementById('download');
        doc = generateDoc();
        link.href = makeTextFile(doc);
        link.style.display = 'block';
        */
    }, false);


    function copyHtml() {
        var html =
            "<div id='transfer_modal' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='transfer_label' style='display: none;'" +
            "aria-hidden='true'>" +
            "  <div class='modal-dialog modal-md' role='document'>" +
            "    <div class='modal-content'>" +
            "      <div class='modal-header'>" +
            "        <h5 class='modal-title' id='transfer_label'>Send guld</h5>" +
            "          <button type='button' class='close' data-dismiss='modal' aria-label='Close'>" +
            "            <span aria-hidden='true'>Ã—</span>" +
            "          </button>" +
            "      </div>" +
            "      <div class='modal-body'>" +
            "        <section id='section-form'>" +
            "          <div class='container'> " +
            "            <div class='row'> " +
            "              <div class='col-md-12'> " +
            "                <form> " +
            "                <div class='form-group row'> " +
            "                  <label for='sender' class='col-sm-4 col-form-label'>Sender Guld Username</label> " +
            "                  <div class='col-sm-8'> " +
            "                    <input type='text' class='form-control' id='sender' placeholder='Sender'> " +
            "                  </div> " +
            "                </div> " +
            "                <div class='form-group row'> " +
            "                  <label for='receiver' class='col-sm-4 col-form-label'>Receiver Guld Username</label> " +
            "                  <div class='col-sm-8'> " +
            "                    <input type='text' class='form-control' id='receiver' placeholder='Receiver'> " +
            "                  </div> " +
            "                </div> " +
            "                <div class='form-group row'> " +
            "                  <label for='amount' class='col-sm-4 col-form-label'>Amount</label> " +
            "                  <div class='col-sm-8'> " +
            "                    <input type='text' class='form-control' id='amount' placeholder='3.5'> " +
            "                  </div> " +
            "                </div> " +
            "                <div class='form-group row text-center'> " +
            "                  <div class='col-sm-12'> " +
            "                    <a id='generate' class='btn btn-primary'>generate</a> " +
            "                    <a download='info.txt' id='download' style='display: none'>Download</a> " +
            "                  </div> " +
            "                </div> " +
            "                </form> " +
            "              </div> " +
            "            </div> " +
            "          </div> " +
            "        </section>" +
            "      </div> " +
            "    </div> " +
            "  </div> " +
            "</div>";
        return html;
    }


})();